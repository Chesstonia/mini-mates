<!DOCTYPE html>
<html data-ng-app="myApp">
  <head>
    <link rel="stylesheet" href="./script/chessboard.js/css/chessboard-0.3.0.css">

    <script type="text/javascript" src="script/chessboard.js/js/chessboard-0.3.0.js"></script>
    <script type="text/javascript" src="script/jquery/jquery-2.2.3.js"></script>
    <script type="text/javascript" src="script/angular.js"></script>
    <script type="text/javascript" src="script/chess.js"></script>
    <script type="text/javascript" src="script/positionList.js"></script>
  </head>

  <body>

    
    <div data-ng-controller="SimpleController">
      <div id="board1" style="width: 400px"></div>
    </div>

    <script>
      var done = false;
      var app = angular.module("myApp", []).controller("SimpleController", function($scope){
        $scope.positions = positionList;
        $scope.count = 0;

        $scope.showRandomPosition = function(){
          var index = Math.floor(Math.random() * positionList.length);

          $scope.fen = positionList[index].fen;
          var solution = positionList[index].solution;
          $scope.showPosition($scope.fen, solution);
        }

        $scope.showPosition = function(fen, solution){
            $scope.chessBoard = ChessBoard('board1', {
                  position: fen,
                  pieceTheme: 'script/chessboard.js/img/chesspieces/wikipedia/{piece}.png',
                  draggable: true,
                  dropOffBoard: 'snapback',
                  showNotation: true,
                  showErrors: 'alert',
                  onDrop: function(source, target, piece, newPosition, oldPosition, orientation){
                      if (done) return;

                      var move = $scope.board.move({from: source, to: target});
                      if (move == null) return 'snapback';
                      if (move.san == (solution + "#")){
                          $scope.count++;
                      }
                      $scope.showRandomPosition();
                  }
            });

            $scope.board = new Chess(fen);
          
        }

        $scope.done = function(){
            alert("you finished " + $scope.count + " in 30 seconds!");
        };

        $scope.showRandomPosition();

        function timer(x){
          if (x == 30) {
            done = true;
            $scope.done();
          } else {
            setTimeout(function(){
              timer(x + 1);
            }, 1000);
          }
        }

        timer(0);
      });
    </script>

  </body>
</html>
